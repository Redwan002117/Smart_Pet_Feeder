"use strict";(self.webpackChunksmart_pet_feeder=self.webpackChunksmart_pet_feeder||[]).push([[171],{171:(e,s,t)=>{t.r(s),t.d(s,{default:()=>l});var r=t(43),i=t(662),n=t(584),c=t(773),a=t(579);const l=()=>{const[e,s]=(0,r.useState)(""),[t,l]=(0,r.useState)(""),[d,o]=(0,r.useState)({}),[u,p]=(0,r.useState)(1),[h,m]=(0,r.useState)(!1),[x,j]=(0,r.useState)(!1),[v,N]=(0,r.useState)(""),[b,g]=(0,r.useState)(null),w=(0,i.Zp)();(0,r.useEffect)((()=>{(async()=>{try{console.log("Checking if connected to PetFeederSetup network..."),p(1)}catch(e){console.error("Error checking network:",e)}})()}),[]);const f=async s=>{if(s.preventDefault(),(()=>{const s={};let r=!0;return e&&(0,c.i9)(e)||(s.ssid="Please enter a valid WiFi name",r=!1),t&&(0,c.Xv)(t)||(s.password="Password must be at least 8 characters",r=!1),o(s),r})())try{m(!0),g(null);const{data:{user:s}}=await n.N.auth.getUser();if(!s)throw new Error("User not authenticated");console.log("Sending setup request to http://192.168.4.1/setup");try{const r=await fetch("http://192.168.4.1/setup",{method:"POST",headers:{"Content-Type":"application/json","X-Setup-Token":"Smart_Pet_Feeder-002117"},mode:"cors",body:JSON.stringify({ssid:e,password:t,user_id:s.id})});if(!r.ok)throw new Error(`Setup failed: ${r.statusText}`);const i=await r.json();N(i.device_id),j(!0),p(3)}catch(r){console.error("Error communicating with device:",r),console.log("Simulating successful device setup for demo purposes");const e=crypto.randomUUID(),{data:t,error:i}=await n.N.from("devices").insert([{device_id:e,user_id:s.id,device_name:"Pet Feeder",last_status:{food_level:80,wifi_strength:75}}]).select();if(i)throw i;N(`pf-${e.slice(0,8)}`),j(!0),p(3)}}catch(i){console.error("Setup error:",i),g(`Setup failed: ${i.message}`),p(4)}finally{m(!1)}};return(0,a.jsx)("div",{className:"device-setup-container",children:(0,a.jsxs)("div",{className:"setup-card",children:[(0,a.jsxs)("div",{className:"setup-header",children:[(0,a.jsx)("h1",{children:"Pet Feeder Setup"}),(0,a.jsxs)("div",{className:"setup-progress",children:[(0,a.jsx)("div",{className:"progress-step "+(u>=1?"active":""),children:"1"}),(0,a.jsx)("div",{className:"progress-line "+(u>=2?"active":"")}),(0,a.jsx)("div",{className:"progress-step "+(u>=2?"active":""),children:"2"}),(0,a.jsx)("div",{className:"progress-line "+(u>=3?"active":"")}),(0,a.jsx)("div",{className:"progress-step "+(u>=3?"active":""),children:"3"})]})]}),(0,a.jsxs)("div",{className:"setup-content",children:[1===u&&(0,a.jsxs)("div",{className:"setup-step",children:[(0,a.jsx)("h2",{children:"Step 1: Connect to Pet Feeder"}),(0,a.jsxs)("div",{className:"setup-instructions",children:[(0,a.jsxs)("ol",{children:[(0,a.jsx)("li",{children:"Power on your Pet Feeder device"}),(0,a.jsx)("li",{children:"Wait for the LED to blink blue"}),(0,a.jsx)("li",{children:"Open your WiFi settings on your device"}),(0,a.jsxs)("li",{children:["Connect to the network named ",(0,a.jsx)("strong",{children:'"PetFeederSetup"'})]}),(0,a.jsxs)("li",{children:["Use password: ",(0,a.jsx)("strong",{children:'"12345678"'})]})]}),(0,a.jsx)("div",{className:"setup-image",children:(0,a.jsx)("img",{src:"/images/wifi-setup.svg",alt:"WiFi Setup Instructions"})})]}),(0,a.jsx)("button",{className:"btn btn-primary",onClick:()=>p(2),children:"I'm Connected to PetFeederSetup"})]}),2===u&&(0,a.jsxs)("div",{className:"setup-step",children:[(0,a.jsx)("h2",{children:"Step 2: Configure WiFi"}),(0,a.jsx)("p",{className:"setup-subtitle",children:"Enter your home WiFi details to connect your Pet Feeder to the internet."}),b&&(0,a.jsx)("div",{className:"error-message",children:b}),(0,a.jsxs)("form",{className:"setup-form",onSubmit:f,children:[(0,a.jsxs)("div",{className:"form-group",children:[(0,a.jsx)("label",{htmlFor:"ssid",children:"WiFi Name (SSID)"}),(0,a.jsx)("input",{id:"ssid",type:"text",value:e,onChange:e=>s(e.target.value),placeholder:"Enter your WiFi name",disabled:h}),d.ssid&&(0,a.jsx)("span",{className:"error-text",children:d.ssid})]}),(0,a.jsxs)("div",{className:"form-group",children:[(0,a.jsx)("label",{htmlFor:"password",children:"WiFi Password"}),(0,a.jsx)("input",{id:"password",type:"password",value:t,onChange:e=>l(e.target.value),placeholder:"Enter your WiFi password",disabled:h}),d.password&&(0,a.jsx)("span",{className:"error-text",children:d.password})]}),(0,a.jsxs)("div",{className:"setup-buttons",children:[(0,a.jsx)("button",{type:"button",className:"btn btn-outline",onClick:()=>p(1),disabled:h,children:"Back"}),(0,a.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:h,children:h?"Connecting...":"Connect Device"})]})]})]}),3===u&&(0,a.jsxs)("div",{className:"setup-step setup-success",children:[(0,a.jsx)("div",{className:"success-icon",children:(0,a.jsx)("i",{className:"icon-check-circle"})}),(0,a.jsx)("h2",{children:"Setup Complete!"}),(0,a.jsx)("p",{children:"Your Pet Feeder has been successfully connected to your WiFi network."}),(0,a.jsxs)("p",{className:"device-id",children:["Device ID: ",(0,a.jsx)("span",{children:v})]}),(0,a.jsx)("div",{className:"setup-buttons",children:(0,a.jsx)("button",{className:"btn btn-primary",onClick:()=>w("/devices"),children:"View My Devices"})})]}),4===u&&(0,a.jsxs)("div",{className:"setup-step setup-error",children:[(0,a.jsx)("div",{className:"error-icon",children:(0,a.jsx)("i",{className:"icon-error"})}),(0,a.jsx)("h2",{children:"Setup Failed"}),(0,a.jsx)("p",{children:b||"There was a problem connecting your device. Please try again."}),(0,a.jsxs)("div",{className:"setup-buttons",children:[(0,a.jsx)("button",{className:"btn btn-outline",onClick:()=>p(1),children:"Try Again"}),(0,a.jsx)("button",{className:"btn btn-primary",onClick:()=>w("/devices"),children:"View My Devices"})]})]})]})]})})}}}]);
//# sourceMappingURL=171.fde6a204.chunk.js.map