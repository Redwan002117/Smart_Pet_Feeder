"use strict";(self.webpackChunksmart_pet_feeder=self.webpackChunksmart_pet_feeder||[]).push([[718],{718:(e,s,a)=>{a.r(s),a.d(s,{default:()=>n});var l=a(43),r=a(584),t=a(579);const n=()=>{const[e,s]=(0,l.useState)(!0),[a,n]=(0,l.useState)([]),[i,c]=(0,l.useState)(null),[d,o]=(0,l.useState)(null),[h,u]=(0,l.useState)(""),[m,x]=(0,l.useState)(""),[j,N]=(0,l.useState)(1),[f,v]=(0,l.useState)(1),[p,b]=(0,l.useState)(null);(0,l.useEffect)((()=>{g()}),[j,m,h]);const g=async()=>{try{s(!0);const{data:{user:e}}=await r.N.auth.getUser();if(!e)throw new Error("User not authenticated");const{data:a}=await r.N.from("profiles").select("role").eq("id",e.id).single();if(!a||"admin"!==a.role)throw new Error("You do not have admin access");let l=r.N.from("profiles").select("*",{count:"exact"});m&&(l=l.eq("role",m)),h&&(l=l.or(`username.ilike.%${h}%,email.ilike.%${h}%,full_name.ilike.%${h}%`));const{count:t}=await l;v(Math.ceil((t||0)/10));const i=10*(j-1),c=i+10-1,{data:d,error:o}=await l.range(i,c).order("created_at",{ascending:!1});if(o)throw o;n(d||[])}catch(e){console.error("Error fetching users:",e),c(e.message||"Failed to load users")}finally{s(!1)}};return e&&0===a.length?(0,t.jsxs)("div",{className:"loading-container",children:[(0,t.jsx)("div",{className:"loading-spinner"}),(0,t.jsx)("p",{children:"Loading users..."})]}):(0,t.jsxs)("div",{className:"user-management-container",children:[(0,t.jsx)("div",{className:"user-management-header",children:(0,t.jsx)("h1",{children:"User Management"})}),i&&(0,t.jsxs)("div",{className:"error-alert",children:[(0,t.jsx)("i",{className:"icon-warning"}),(0,t.jsx)("p",{children:i}),(0,t.jsx)("button",{className:"error-close",onClick:()=>c(null),children:"\xd7"})]}),d&&(0,t.jsxs)("div",{className:"success-alert",children:[(0,t.jsx)("i",{className:"icon-check-circle"}),(0,t.jsx)("p",{children:d}),(0,t.jsx)("button",{className:"success-close",onClick:()=>o(null),children:"\xd7"})]}),(0,t.jsxs)("div",{className:"user-controls",children:[(0,t.jsxs)("form",{className:"search-form",onSubmit:e=>{e.preventDefault(),N(1),g()},children:[(0,t.jsxs)("div",{className:"search-input",children:[(0,t.jsx)("i",{className:"icon-search"}),(0,t.jsx)("input",{type:"text",placeholder:"Search users...",value:h,onChange:e=>u(e.target.value)})]}),(0,t.jsx)("button",{type:"submit",className:"btn btn-primary",children:"Search"})]}),(0,t.jsxs)("div",{className:"filter-controls",children:[(0,t.jsx)("label",{htmlFor:"role-filter",children:"Filter by Role:"}),(0,t.jsxs)("select",{id:"role-filter",value:m,onChange:e=>{x(e.target.value),N(1)},children:[(0,t.jsx)("option",{value:"",children:"All Roles"}),(0,t.jsx)("option",{value:"user",children:"User"}),(0,t.jsx)("option",{value:"admin",children:"Admin"})]})]})]}),(0,t.jsx)("div",{className:"user-list-container",children:(0,t.jsxs)("table",{className:"user-table",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"User"}),(0,t.jsx)("th",{children:"Email"}),(0,t.jsx)("th",{children:"Username"}),(0,t.jsx)("th",{children:"Joined"}),(0,t.jsx)("th",{children:"Role"}),(0,t.jsx)("th",{children:"Actions"})]})}),(0,t.jsx)("tbody",{children:a.map((l=>{var i,d,h;return(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{children:(0,t.jsxs)("div",{className:"user-info",children:[l.avatar_url?(0,t.jsx)("img",{src:l.avatar_url,alt:l.username,className:"user-avatar"}):(0,t.jsx)("div",{className:"avatar-placeholder",children:(null===(i=l.username)||void 0===i||null===(d=i[0])||void 0===d?void 0:d.toUpperCase())||"U"}),(0,t.jsx)("div",{className:"user-name",children:l.full_name||"No Name"})]})}),(0,t.jsx)("td",{children:l.email}),(0,t.jsxs)("td",{children:["@",l.username]}),(0,t.jsx)("td",{children:(h=l.created_at,new Date(h).toLocaleDateString())}),(0,t.jsx)("td",{children:(0,t.jsxs)("select",{value:l.role,onChange:e=>(async(e,l)=>{try{s(!0),c(null);const{error:t}=await r.N.from("profiles").update({role:l}).eq("id",e);if(t)throw t;n(a.map((s=>s.id===e?{...s,role:l}:s))),o(`User role updated to ${l} successfully`)}catch(t){console.error("Error updating user role:",t),c(t.message||"Failed to update user role")}finally{s(!1)}})(l.id,e.target.value),className:`role-select ${l.role}`,disabled:e,children:[(0,t.jsx)("option",{value:"user",children:"User"}),(0,t.jsx)("option",{value:"admin",children:"Admin"})]})}),(0,t.jsx)("td",{children:(0,t.jsx)("div",{className:"user-actions",children:(0,t.jsx)("button",{className:"btn btn-icon btn-danger",onClick:()=>b(l.id),title:"Delete User",disabled:e,children:(0,t.jsx)("i",{className:"icon-trash"})})})})]},l.id)}))})]})}),(0,t.jsxs)("div",{className:"pagination",children:[(0,t.jsx)("button",{className:"btn btn-sm",disabled:1===j,onClick:()=>N((e=>Math.max(1,e-1))),children:"Previous"}),(0,t.jsxs)("span",{className:"page-info",children:["Page ",j," of ",f]}),(0,t.jsx)("button",{className:"btn btn-sm",disabled:j===f,onClick:()=>N((e=>Math.min(f,e+1))),children:"Next"})]}),p&&(0,t.jsx)("div",{className:"modal-overlay",children:(0,t.jsxs)("div",{className:"modal-content",children:[(0,t.jsxs)("div",{className:"modal-header",children:[(0,t.jsx)("h2",{children:"Delete User"}),(0,t.jsx)("button",{className:"modal-close",onClick:()=>b(null),children:"\xd7"})]}),(0,t.jsx)("div",{className:"modal-body",children:(0,t.jsx)("p",{className:"confirm-message",children:"Are you sure you want to delete this user? This will also delete all associated data including devices, pets, and feeding history. This action cannot be undone."})}),(0,t.jsxs)("div",{className:"modal-footer",children:[(0,t.jsx)("button",{className:"btn btn-outline",onClick:()=>b(null),children:"Cancel"}),(0,t.jsx)("button",{className:"btn btn-danger",onClick:()=>(async e=>{try{s(!0),c(null);const{error:l}=await r.N.from("devices").delete().eq("user_id",e);if(l)throw l;const{error:t}=await r.N.from("pets").delete().eq("user_id",e);if(t)throw t;const{error:i}=await r.N.from("schedules").delete().eq("user_id",e);if(i)throw i;const{error:d}=await r.N.from("profiles").delete().eq("id",e);if(d)throw d;const{error:h}=await r.N.auth.admin.deleteUser(e);if(h)throw h;n(a.filter((s=>s.id!==e))),b(null),o("User deleted successfully")}catch(l){console.error("Error deleting user:",l),c(l.message||"Failed to delete user")}finally{s(!1)}})(p),disabled:e,children:"Delete User"})]})]})})]})}}}]);
//# sourceMappingURL=718.a3ae0305.chunk.js.map