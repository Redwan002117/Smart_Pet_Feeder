{"ast":null,"code":"import React,{useState,useEffect}from'react';import{supabase}from'../supabaseClient.ts';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const SchedulePage=()=>{const[schedules,setSchedules]=useState([]);const[newSchedule,setNewSchedule]=useState({time:'',amount:0,device_id:''});const[showForm,setShowForm]=useState(false);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);useEffect(()=>{const fetchSchedules=async()=>{try{// Get the current user using the new Supabase API\nconst{data:{user},error:userError}=await supabase.auth.getUser();if(userError){throw userError;}if(!user){setLoading(false);setError('You need to be logged in to view schedules');return;}const{data,error:scheduleError}=await supabase.from('schedules').select('*').eq('user_id',user.id);if(scheduleError){throw scheduleError;}else{setSchedules(data||[]);}}catch(err){console.error('Error fetching schedules:',err);setError(err.message||'Failed to load schedules');}finally{setLoading(false);}};fetchSchedules();},[]);const handleAddSchedule=async e=>{e.preventDefault();try{// Get the current user using the new Supabase API\nconst{data:{user},error:userError}=await supabase.auth.getUser();if(userError){throw userError;}if(!user){setError('You need to be logged in to create schedules');return;}const{data,error:insertError}=await supabase.from('schedules').insert([{...newSchedule,user_id:user.id}]).select();if(insertError){throw insertError;}else{if(data&&data.length>0){setSchedules([...schedules,data[0]]);setShowForm(false);setNewSchedule({time:'',amount:0,device_id:''});}}}catch(err){console.error('Error adding schedule:',err);setError(err.message||'Failed to create schedule');}};return/*#__PURE__*/_jsxs(\"div\",{className:\"schedule-page\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Feeding Schedules\"}),error&&/*#__PURE__*/_jsxs(\"div\",{className:\"error-alert\",children:[/*#__PURE__*/_jsx(\"p\",{children:error}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setError(null),children:\"\\xD7\"})]}),loading?/*#__PURE__*/_jsxs(\"div\",{className:\"loading-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Loading schedules...\"})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",onClick:()=>setShowForm(true),children:\"Add Schedule\"}),schedules.length>0?/*#__PURE__*/_jsx(\"ul\",{className:\"schedule-list\",children:schedules.map(schedule=>/*#__PURE__*/_jsx(\"li\",{className:\"schedule-item\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"schedule-info\",children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"Time: \",new Date(schedule.time).toLocaleString()]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Amount: \",schedule.amount,\"g\"]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Device ID: \",schedule.device_id]})]})},schedule.schedule_id))}):/*#__PURE__*/_jsx(\"div\",{className:\"empty-state\",children:/*#__PURE__*/_jsx(\"p\",{children:\"No schedules found. Add your first feeding schedule!\"})})]}),showForm&&/*#__PURE__*/_jsx(\"div\",{className:\"modal\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-content\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"modal-header\",children:/*#__PURE__*/_jsx(\"h2\",{children:\"Add Schedule\"})}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleAddSchedule,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-body\",children:[/*#__PURE__*/_jsxs(\"label\",{children:[\"Time:\",/*#__PURE__*/_jsx(\"input\",{type:\"datetime-local\",value:newSchedule.time,onChange:e=>setNewSchedule({...newSchedule,time:e.target.value}),required:true})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"Amount (grams):\",/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:newSchedule.amount,onChange:e=>setNewSchedule({...newSchedule,amount:parseInt(e.target.value)}),min:\"1\",required:true})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"Device ID:\",/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:newSchedule.device_id,onChange:e=>setNewSchedule({...newSchedule,device_id:e.target.value}),required:true})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-footer\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-outline\",onClick:()=>setShowForm(false),children:\"Cancel\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",type:\"submit\",children:\"Add Schedule\"})]})]})]})})]});};export default SchedulePage;","map":{"version":3,"names":["React","useState","useEffect","supabase","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","SchedulePage","schedules","setSchedules","newSchedule","setNewSchedule","time","amount","device_id","showForm","setShowForm","loading","setLoading","error","setError","fetchSchedules","data","user","userError","auth","getUser","scheduleError","from","select","eq","id","err","console","message","handleAddSchedule","e","preventDefault","insertError","insert","user_id","length","className","children","onClick","map","schedule","Date","toLocaleString","schedule_id","onSubmit","type","value","onChange","target","required","parseInt","min"],"sources":["/workspaces/Smart_Pet_Feeder/src/pages/Schedule.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { supabase } from '../supabaseClient.ts';\nimport { Schedule } from '../types';\n\nconst SchedulePage: React.FC = () => {\n  const [schedules, setSchedules] = useState<Schedule[]>([]);\n  const [newSchedule, setNewSchedule] = useState({ time: '', amount: 0, device_id: '' });\n  const [showForm, setShowForm] = useState(false);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    const fetchSchedules = async () => {\n      try {\n        // Get the current user using the new Supabase API\n        const { data: { user }, error: userError } = await supabase.auth.getUser();\n        \n        if (userError) {\n          throw userError;\n        }\n        \n        if (!user) {\n          setLoading(false);\n          setError('You need to be logged in to view schedules');\n          return;\n        }\n        \n        const { data, error: scheduleError } = await supabase\n          .from('schedules')\n          .select('*')\n          .eq('user_id', user.id);\n\n        if (scheduleError) {\n          throw scheduleError;\n        } else {\n          setSchedules(data || []);\n        }\n      } catch (err: any) {\n        console.error('Error fetching schedules:', err);\n        setError(err.message || 'Failed to load schedules');\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchSchedules();\n  }, []);\n\n  const handleAddSchedule = async (e: React.FormEvent) => {\n    e.preventDefault();\n    try {\n      // Get the current user using the new Supabase API\n      const { data: { user }, error: userError } = await supabase.auth.getUser();\n      \n      if (userError) {\n        throw userError;\n      }\n      \n      if (!user) {\n        setError('You need to be logged in to create schedules');\n        return;\n      }\n      \n      const { data, error: insertError } = await supabase\n        .from('schedules')\n        .insert([{ ...newSchedule, user_id: user.id }])\n        .select();\n\n      if (insertError) {\n        throw insertError;\n      } else {\n        if (data && data.length > 0) {\n          setSchedules([...schedules, data[0]]);\n          setShowForm(false);\n          setNewSchedule({ time: '', amount: 0, device_id: '' });\n        }\n      }\n    } catch (err: any) {\n      console.error('Error adding schedule:', err);\n      setError(err.message || 'Failed to create schedule');\n    }\n  };\n\n  return (\n    <div className=\"schedule-page\">\n      <h1>Feeding Schedules</h1>\n      \n      {error && (\n        <div className=\"error-alert\">\n          <p>{error}</p>\n          <button onClick={() => setError(null)}>Ã—</button>\n        </div>\n      )}\n      \n      {loading ? (\n        <div className=\"loading-container\">\n          <div className=\"loading-spinner\"></div>\n          <p>Loading schedules...</p>\n        </div>\n      ) : (\n        <>\n          <button className=\"btn btn-primary\" onClick={() => setShowForm(true)}>\n            Add Schedule\n          </button>\n          \n          {schedules.length > 0 ? (\n            <ul className=\"schedule-list\">\n              {schedules.map(schedule => (\n                <li key={schedule.schedule_id} className=\"schedule-item\">\n                  <div className=\"schedule-info\">\n                    <p>Time: {new Date(schedule.time).toLocaleString()}</p>\n                    <p>Amount: {schedule.amount}g</p>\n                    <p>Device ID: {schedule.device_id}</p>\n                  </div>\n                </li>\n              ))}\n            </ul>\n          ) : (\n            <div className=\"empty-state\">\n              <p>No schedules found. Add your first feeding schedule!</p>\n            </div>\n          )}\n        </>\n      )}\n\n      {showForm && (\n        <div className=\"modal\">\n          <div className=\"modal-content\">\n            <div className=\"modal-header\">\n              <h2>Add Schedule</h2>\n            </div>\n            <form onSubmit={handleAddSchedule}>\n              <div className=\"modal-body\">\n                <label>\n                  Time:\n                  <input\n                    type=\"datetime-local\"\n                    value={newSchedule.time}\n                    onChange={e => setNewSchedule({ ...newSchedule, time: e.target.value })}\n                    required\n                  />\n                </label>\n                <label>\n                  Amount (grams):\n                  <input\n                    type=\"number\"\n                    value={newSchedule.amount}\n                    onChange={e => setNewSchedule({ ...newSchedule, amount: parseInt(e.target.value) })}\n                    min=\"1\"\n                    required\n                  />\n                </label>\n                <label>\n                  Device ID:\n                  <input\n                    type=\"text\"\n                    value={newSchedule.device_id}\n                    onChange={e => setNewSchedule({ ...newSchedule, device_id: e.target.value })}\n                    required\n                  />\n                </label>\n              </div>\n              <div className=\"modal-footer\">\n                <button \n                  type=\"button\" \n                  className=\"btn btn-outline\" \n                  onClick={() => setShowForm(false)}\n                >\n                  Cancel\n                </button>\n                <button className=\"btn btn-primary\" type=\"submit\">\n                  Add Schedule\n                </button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default SchedulePage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}