"use strict";(self.webpackChunksmart_pet_feeder=self.webpackChunksmart_pet_feeder||[]).push([[848],{848:(e,s,r)=>{r.r(s),r.d(s,{default:()=>i});var a=r(43),t=r(662),n=r(584),o=r(579);const i=()=>{const[e,s]=(0,a.useState)(null),r=(0,t.Zp)();return(0,a.useEffect)((()=>{(async()=>{try{const s=new URLSearchParams(window.location.hash.substring(1)),a=new URLSearchParams(window.location.search);if(s.get("access_token")){var e;const{data:s,error:a}=await n.N.auth.getSession();if(a)throw a;if(null!==s&&void 0!==s&&null!==(e=s.session)&&void 0!==e&&e.user){const{data:e,error:a}=await n.N.from("profiles").select("*").eq("id",s.session.user.id).single();if(a&&a.message.includes("No rows found")){const{error:e}=await n.N.from("profiles").insert([{id:s.session.user.id,username:s.session.user.user_metadata.username||`user${Date.now().toString().slice(-6)}`,email:s.session.user.email,role:"user"}]);e&&console.error("Error creating profile:",e)}r("/dashboard")}}else if("recovery"===a.get("type")||"signup"===a.get("type")){const e=a.get("token");if(!e)throw new Error("No token found in URL");if("recovery"===a.get("type"))r("/reset-password",{state:{token:e}});else if("signup"===a.get("type")){const{error:s}=await n.N.auth.verifyOtp({token_hash:e,type:"signup"});if(s)throw s;r("/login",{state:{message:"Email confirmed! You can now log in."}})}}else{const{data:e}=await n.N.auth.getSession();r(e.session?"/dashboard":"/login")}}catch(a){console.error("Auth callback error:",a),s(a.message||"An error occurred during authentication")}})()}),[r]),e?(0,o.jsx)("div",{className:"auth-callback-container",children:(0,o.jsxs)("div",{className:"auth-callback-error",children:[(0,o.jsx)("i",{className:"icon-error"}),(0,o.jsx)("h2",{children:"Authentication Error"}),(0,o.jsx)("p",{children:e}),(0,o.jsx)("button",{className:"btn btn-primary",onClick:()=>r("/login"),children:"Back to Login"})]})}):(0,o.jsx)("div",{className:"auth-callback-container",children:(0,o.jsxs)("div",{className:"auth-callback-loading",children:[(0,o.jsx)("div",{className:"loading-spinner"}),(0,o.jsx)("p",{children:"Completing authentication..."})]})})}}}]);
//# sourceMappingURL=848.f34109c3.chunk.js.map