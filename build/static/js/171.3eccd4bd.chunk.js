"use strict";(self.webpackChunksmart_pet_feeder=self.webpackChunksmart_pet_feeder||[]).push([[171],{171:(e,s,t)=>{t.r(s),t.d(s,{default:()=>l});var i=t(43),r=t(662),n=t(584),a=t(773),c=t(579);const l=()=>{const[e,s]=(0,i.useState)(""),[t,l]=(0,i.useState)(""),[o,d]=(0,i.useState)({}),[u,p]=(0,i.useState)(1),[h,m]=(0,i.useState)(!1),[x,j]=(0,i.useState)(!1),[v,N]=(0,i.useState)(""),[b,g]=(0,i.useState)(null),w=(0,r.Zp)();(0,i.useEffect)((()=>{(async()=>{try{console.log("Checking if connected to PetFeederSetup network..."),p(1)}catch(e){console.error("Error checking network:",e)}})()}),[]);const f=async s=>{if(s.preventDefault(),(()=>{const s={};let i=!0;return e&&(0,a.i9)(e)||(s.ssid="Please enter a valid WiFi name",i=!1),t&&(0,a.Xv)(t)||(s.password="Password must be at least 8 characters",i=!1),d(s),i})())try{m(!0),g(null);const{data:{user:s}}=await n.N.auth.getUser();if(!s)throw new Error("User not authenticated");console.log("Sending setup request to http://192.168.4.1/setup");try{const i=await fetch("http://192.168.4.1/setup",{method:"POST",headers:{"Content-Type":"application/json","X-Setup-Token":"your-secret-token-1234"},body:JSON.stringify({ssid:e,password:t,user_id:s.id})});if(!i.ok)throw new Error(`Setup failed: ${i.statusText}`);const r=await i.json();N(r.device_id),j(!0),p(3)}catch(i){console.error("Error communicating with device:",i),console.log("Simulating successful device setup for demo purposes");const e=`pf-${Math.random().toString(16).slice(2,10)}`,{data:t,error:r}=await n.N.from("devices").insert([{device_id:e,user_id:s.id,device_name:"Pet Feeder",last_status:{food_level:80,wifi_strength:75}}]).select();if(r)throw r;N(e),j(!0),p(3)}}catch(r){console.error("Setup error:",r),g(`Setup failed: ${r.message}`),p(4)}finally{m(!1)}};return(0,c.jsx)("div",{className:"device-setup-container",children:(0,c.jsxs)("div",{className:"setup-card",children:[(0,c.jsxs)("div",{className:"setup-header",children:[(0,c.jsx)("h1",{children:"Pet Feeder Setup"}),(0,c.jsxs)("div",{className:"setup-progress",children:[(0,c.jsx)("div",{className:"progress-step "+(u>=1?"active":""),children:"1"}),(0,c.jsx)("div",{className:"progress-line "+(u>=2?"active":"")}),(0,c.jsx)("div",{className:"progress-step "+(u>=2?"active":""),children:"2"}),(0,c.jsx)("div",{className:"progress-line "+(u>=3?"active":"")}),(0,c.jsx)("div",{className:"progress-step "+(u>=3?"active":""),children:"3"})]})]}),(0,c.jsxs)("div",{className:"setup-content",children:[1===u&&(0,c.jsxs)("div",{className:"setup-step",children:[(0,c.jsx)("h2",{children:"Step 1: Connect to Pet Feeder"}),(0,c.jsxs)("div",{className:"setup-instructions",children:[(0,c.jsxs)("ol",{children:[(0,c.jsx)("li",{children:"Power on your Pet Feeder device"}),(0,c.jsx)("li",{children:"Wait for the LED to blink blue"}),(0,c.jsx)("li",{children:"Open your WiFi settings on your device"}),(0,c.jsxs)("li",{children:["Connect to the network named ",(0,c.jsx)("strong",{children:'"PetFeederSetup"'})]}),(0,c.jsxs)("li",{children:["Use password: ",(0,c.jsx)("strong",{children:'"12345678"'})]})]}),(0,c.jsx)("div",{className:"setup-image",children:(0,c.jsx)("img",{src:"/images/wifi-setup.svg",alt:"WiFi Setup Instructions"})})]}),(0,c.jsx)("button",{className:"btn btn-primary",onClick:()=>p(2),children:"I'm Connected to PetFeederSetup"})]}),2===u&&(0,c.jsxs)("div",{className:"setup-step",children:[(0,c.jsx)("h2",{children:"Step 2: Configure WiFi"}),(0,c.jsx)("p",{className:"setup-subtitle",children:"Enter your home WiFi details to connect your Pet Feeder to the internet."}),b&&(0,c.jsx)("div",{className:"error-message",children:b}),(0,c.jsxs)("form",{className:"setup-form",onSubmit:f,children:[(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{htmlFor:"ssid",children:"WiFi Name (SSID)"}),(0,c.jsx)("input",{id:"ssid",type:"text",value:e,onChange:e=>s(e.target.value),placeholder:"Enter your WiFi name",disabled:h}),o.ssid&&(0,c.jsx)("span",{className:"error-text",children:o.ssid})]}),(0,c.jsxs)("div",{className:"form-group",children:[(0,c.jsx)("label",{htmlFor:"password",children:"WiFi Password"}),(0,c.jsx)("input",{id:"password",type:"password",value:t,onChange:e=>l(e.target.value),placeholder:"Enter your WiFi password",disabled:h}),o.password&&(0,c.jsx)("span",{className:"error-text",children:o.password})]}),(0,c.jsxs)("div",{className:"setup-buttons",children:[(0,c.jsx)("button",{type:"button",className:"btn btn-outline",onClick:()=>p(1),disabled:h,children:"Back"}),(0,c.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:h,children:h?"Connecting...":"Connect Device"})]})]})]}),3===u&&(0,c.jsxs)("div",{className:"setup-step setup-success",children:[(0,c.jsx)("div",{className:"success-icon",children:(0,c.jsx)("i",{className:"icon-check-circle"})}),(0,c.jsx)("h2",{children:"Setup Complete!"}),(0,c.jsx)("p",{children:"Your Pet Feeder has been successfully connected to your WiFi network."}),(0,c.jsxs)("p",{className:"device-id",children:["Device ID: ",(0,c.jsx)("span",{children:v})]}),(0,c.jsx)("div",{className:"setup-buttons",children:(0,c.jsx)("button",{className:"btn btn-primary",onClick:()=>w("/devices"),children:"View My Devices"})})]}),4===u&&(0,c.jsxs)("div",{className:"setup-step setup-error",children:[(0,c.jsx)("div",{className:"error-icon",children:(0,c.jsx)("i",{className:"icon-error"})}),(0,c.jsx)("h2",{children:"Setup Failed"}),(0,c.jsx)("p",{children:b||"There was a problem connecting your device. Please try again."}),(0,c.jsxs)("div",{className:"setup-buttons",children:[(0,c.jsx)("button",{className:"btn btn-outline",onClick:()=>p(1),children:"Try Again"}),(0,c.jsx)("button",{className:"btn btn-primary",onClick:()=>w("/devices"),children:"View My Devices"})]})]})]})]})})}}}]);
//# sourceMappingURL=171.3eccd4bd.chunk.js.map