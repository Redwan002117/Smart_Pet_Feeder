"use strict";(self.webpackChunksmart_pet_feeder=self.webpackChunksmart_pet_feeder||[]).push([[471],{471:(e,a,s)=>{s.r(a),s.d(a,{default:()=>r});var l=s(43),i=s(584),n=s(579);const r=()=>{var e,a;const[s,r]=(0,l.useState)(!0),[t,o]=(0,l.useState)(null),[c,d]=(0,l.useState)(null),[u,m]=(0,l.useState)(null),[h,v]=(0,l.useState)(!1),[f,x]=(0,l.useState)(""),[p,j]=(0,l.useState)(""),[N,g]=(0,l.useState)(null),[b,y]=(0,l.useState)(null),[w,S]=(0,l.useState)(0),[k,C]=(0,l.useState)(!1),[q,_]=(0,l.useState)(!1),[F,U]=(0,l.useState)("");(0,l.useEffect)((()=>{A()}),[]);const A=async()=>{try{r(!0);const{data:{user:e}}=await i.N.auth.getUser();if(!e)throw new Error("User not authenticated");const{data:a,error:s}=await i.N.from("profiles").select("*").eq("id",e.id).single();if(s)throw s;a&&(o(a),x(a.full_name||""),j(a.username||""),g(a.avatar_url||null))}catch(e){console.error("Error fetching profile:",e),d("Failed to load profile. Please try again.")}finally{r(!1)}},P=async()=>{if(b&&t)try{C(!0);const e=b.name.split(".").pop(),a=`avatars/${`${t.id}-${Math.random().toString(36).substring(2)}.${e}`}`,{error:s}=await i.N.storage.from("user-avatars").upload(a,b,{cacheControl:"3600",upsert:!0});if(s)throw s;const{data:l}=i.N.storage.from("user-avatars").getPublicUrl(a),{error:n}=await i.N.from("profiles").update({avatar_url:l.publicUrl}).eq("id",t.id);if(n)throw n;g(l.publicUrl)}catch(e){console.error("Error uploading avatar:",e),d("Failed to upload avatar. Please try again.")}finally{C(!1),y(null)}},E=e=>e?new Date(e).toLocaleDateString():"Unknown";return s&&!t?(0,n.jsxs)("div",{className:"loading-container",children:[(0,n.jsx)("div",{className:"loading-spinner"}),(0,n.jsx)("p",{children:"Loading profile..."})]}):(0,n.jsxs)("div",{className:"profile-container",children:[(0,n.jsx)("div",{className:"profile-header",children:(0,n.jsx)("h1",{children:"My Profile"})}),c&&(0,n.jsxs)("div",{className:"error-alert",children:[(0,n.jsx)("i",{className:"icon-warning"}),(0,n.jsx)("p",{children:c}),(0,n.jsx)("button",{className:"error-close",onClick:()=>d(null),children:"\xd7"})]}),u&&(0,n.jsxs)("div",{className:"success-alert",children:[(0,n.jsx)("i",{className:"icon-check-circle"}),(0,n.jsx)("p",{children:u}),(0,n.jsx)("button",{className:"success-close",onClick:()=>m(null),children:"\xd7"})]}),(0,n.jsx)("div",{className:"profile-content",children:(0,n.jsxs)("div",{className:"profile-card",children:[(0,n.jsxs)("div",{className:"profile-sidebar",children:[(0,n.jsxs)("div",{className:"avatar-container",children:[N?(0,n.jsx)("img",{src:N,alt:(null===t||void 0===t?void 0:t.username)||"User",className:"avatar-image"}):(0,n.jsx)("div",{className:"avatar-placeholder",children:(null===t||void 0===t||null===(e=t.username)||void 0===e||null===(a=e[0])||void 0===a?void 0:a.toUpperCase())||"U"}),h&&(0,n.jsxs)("div",{className:"avatar-upload",children:[(0,n.jsxs)("label",{htmlFor:"avatar-input",className:"upload-label",children:[(0,n.jsx)("i",{className:"icon-camera"}),(0,n.jsx)("span",{children:"Change"})]}),(0,n.jsx)("input",{id:"avatar-input",type:"file",accept:"image/*",onChange:e=>{if(!e.target.files||0===e.target.files.length)return;const a=e.target.files[0];if(a.size>2097152)return void d("Image is too large. Please select an image under 2MB.");const s=new FileReader;s.onload=e=>{var a;null!==(a=e.target)&&void 0!==a&&a.result&&g(e.target.result)},s.readAsDataURL(a),y(a)},className:"upload-input"})]})]}),!h&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h2",{className:"profile-name",children:(null===t||void 0===t?void 0:t.full_name)||(null===t||void 0===t?void 0:t.username)||"User"}),(0,n.jsxs)("div",{className:"profile-meta",children:[(0,n.jsxs)("div",{className:"meta-item",children:[(0,n.jsx)("i",{className:"icon-calendar"}),"Joined ",E(null===t||void 0===t?void 0:t.created_at)]}),(0,n.jsxs)("div",{className:"meta-item",children:[(0,n.jsx)("i",{className:"icon-user"}),"@",null===t||void 0===t?void 0:t.username]})]}),(0,n.jsx)("button",{className:"btn btn-primary btn-edit-profile",onClick:()=>v(!0),children:"Edit Profile"})]})]}),(0,n.jsx)("div",{className:"profile-details",children:h?(0,n.jsxs)("form",{className:"edit-profile-form",onSubmit:async e=>{if(e.preventDefault(),t)try{if(r(!0),d(null),!p.trim())return d("Username cannot be empty"),void r(!1);const{data:e,error:a}=await i.N.from("profiles").select("id").eq("username",p).neq("id",t.id);if(a)throw a;if(e&&e.length>0)return d("This username is already taken"),void r(!1);const s={username:p,full_name:f,updated_at:(new Date).toISOString()},{error:l}=await i.N.from("profiles").update(s).eq("id",t.id);if(l)throw l;b&&await P(),m("Profile updated successfully"),await A(),v(!1)}catch(a){console.error("Error updating profile:",a),d(a.message||"Failed to update profile")}finally{r(!1)}},children:[(0,n.jsx)("h2",{children:"Edit Profile"}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"username",children:"Username"}),(0,n.jsx)("input",{id:"username",type:"text",value:p,onChange:e=>j(e.target.value),maxLength:20,required:!0}),(0,n.jsx)("small",{className:"form-hint",children:"This will be your public @username"})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"full-name",children:"Full Name (Optional)"}),(0,n.jsx)("input",{id:"full-name",type:"text",value:f,onChange:e=>x(e.target.value),maxLength:50})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"email",children:"Email"}),(0,n.jsx)("input",{id:"email",type:"email",value:(null===t||void 0===t?void 0:t.email)||"",disabled:!0,className:"readonly-input"}),(0,n.jsx)("small",{className:"form-hint",children:"Email cannot be changed"})]}),(0,n.jsxs)("div",{className:"form-actions",children:[(0,n.jsx)("button",{type:"button",className:"btn btn-outline",onClick:()=>{v(!1),x((null===t||void 0===t?void 0:t.full_name)||""),j((null===t||void 0===t?void 0:t.username)||""),g((null===t||void 0===t?void 0:t.avatar_url)||null),y(null),d(null)},disabled:s,children:"Cancel"}),(0,n.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:s,children:s?"Saving...":"Save Changes"})]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h2",{children:"Account Information"}),(0,n.jsxs)("div",{className:"info-group",children:[(0,n.jsx)("div",{className:"info-label",children:"Email"}),(0,n.jsx)("div",{className:"info-value",children:null===t||void 0===t?void 0:t.email})]}),(0,n.jsxs)("div",{className:"info-group",children:[(0,n.jsx)("div",{className:"info-label",children:"Username"}),(0,n.jsxs)("div",{className:"info-value",children:["@",null===t||void 0===t?void 0:t.username]})]}),(null===t||void 0===t?void 0:t.full_name)&&(0,n.jsxs)("div",{className:"info-group",children:[(0,n.jsx)("div",{className:"info-label",children:"Full Name"}),(0,n.jsx)("div",{className:"info-value",children:t.full_name})]}),(0,n.jsxs)("div",{className:"info-group",children:[(0,n.jsx)("div",{className:"info-label",children:"Account Type"}),(0,n.jsxs)("div",{className:"info-value account-type",children:[(0,n.jsx)("span",{className:`role-badge ${null===t||void 0===t?void 0:t.role}`,children:"admin"===(null===t||void 0===t?void 0:t.role)?"Administrator":"Standard User"}),"admin"!==(null===t||void 0===t?void 0:t.role)&&(0,n.jsx)("button",{className:"btn btn-text",onClick:()=>_(!0),children:"Request Admin Access"})]})]}),(0,n.jsxs)("div",{className:"info-group",children:[(0,n.jsx)("div",{className:"info-label",children:"Joined"}),(0,n.jsx)("div",{className:"info-value",children:E(null===t||void 0===t?void 0:t.created_at)})]}),(0,n.jsx)("h3",{children:"Account Security"}),(0,n.jsxs)("div",{className:"security-links",children:[(0,n.jsxs)("a",{href:"/settings",className:"security-link",children:[(0,n.jsx)("i",{className:"icon-lock"}),(0,n.jsxs)("div",{className:"link-content",children:[(0,n.jsx)("span",{className:"link-title",children:"Security Settings"}),(0,n.jsx)("span",{className:"link-description",children:"Change password, enable 2FA, manage sessions"})]}),(0,n.jsx)("i",{className:"icon-arrow-right"})]}),(0,n.jsxs)("a",{href:"/settings#notifications",className:"security-link",children:[(0,n.jsx)("i",{className:"icon-bell"}),(0,n.jsxs)("div",{className:"link-content",children:[(0,n.jsx)("span",{className:"link-title",children:"Notification Preferences"}),(0,n.jsx)("span",{className:"link-description",children:"Manage your notification settings"})]}),(0,n.jsx)("i",{className:"icon-arrow-right"})]})]})]})})]})}),q&&(0,n.jsx)("div",{className:"modal-overlay",children:(0,n.jsxs)("div",{className:"modal-content",children:[(0,n.jsxs)("div",{className:"modal-header",children:[(0,n.jsx)("h2",{children:"Request Admin Access"}),(0,n.jsx)("button",{className:"modal-close",onClick:()=>_(!1),children:"\xd7"})]}),(0,n.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),t)try{if(r(!0),d(null),!F.trim())return void d("Please provide a reason for your request");console.log("Admin request submitted:",{userId:t.id,username:t.username,email:t.email,reason:F}),m("Admin role request submitted successfully. You will be contacted soon."),_(!1),U("")}catch(a){console.error("Error submitting admin request:",a),d(a.message||"Failed to submit admin request")}finally{r(!1)}},children:[(0,n.jsxs)("div",{className:"modal-body",children:[(0,n.jsx)("p",{className:"admin-request-info",children:"Admin access provides additional privileges to manage users, system settings, and access to advanced features. Please explain why you need admin access:"}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"admin-reason",children:"Reason for Request"}),(0,n.jsx)("textarea",{id:"admin-reason",value:F,onChange:e=>U(e.target.value),rows:5,placeholder:"Please explain why you need admin access...",required:!0})]})]}),(0,n.jsxs)("div",{className:"modal-footer",children:[(0,n.jsx)("button",{type:"button",className:"btn btn-outline",onClick:()=>_(!1),children:"Cancel"}),(0,n.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:s,children:"Submit Request"})]})]})]})})]})}}}]);
//# sourceMappingURL=471.87043b9b.chunk.js.map