"use strict";(self.webpackChunksmart_pet_feeder=self.webpackChunksmart_pet_feeder||[]).push([[503],{503:(e,a,s)=>{s.r(a),s.d(a,{default:()=>n});var t=s(43),l=s(584),i=s(579);const n=()=>{const[e,a]=(0,t.useState)([]),[s,n]=(0,t.useState)(!0),[r,d]=(0,t.useState)(null),[c,o]=(0,t.useState)(!1),[h,m]=(0,t.useState)(null),[p,u]=(0,t.useState)(null),[x,j]=(0,t.useState)(""),[v,N]=(0,t.useState)(0),[g,b]=(0,t.useState)(0),[y,_]=(0,t.useState)(""),[f,w]=(0,t.useState)("medium"),[C,k]=(0,t.useState)("");(0,t.useEffect)((()=>{S();const e=l.N.channel("pets-changes").on("postgres_changes",{event:"*",schema:"public",table:"pets"},A).subscribe();return()=>{e.unsubscribe()}}),[]);const S=async()=>{try{n(!0);const{data:{user:e}}=await l.N.auth.getUser();if(!e)throw new Error("User not authenticated");const{data:s,error:t}=await l.N.from("pets").select("*").eq("user_id",e.id).order("name");if(t)throw t;a(s||[])}catch(e){console.error("Error fetching pets:",e),d(e.message||"Failed to load pets")}finally{n(!1)}},A=e=>{const{eventType:s,new:t,old:l}=e;"INSERT"===s?a((e=>[...e,t].sort(((e,a)=>e.name.localeCompare(a.name))))):"UPDATE"===s?a((e=>e.map((e=>e.pet_id===t.pet_id?t:e)))):"DELETE"===s&&a((e=>e.filter((e=>e.pet_id!==l.pet_id))))},E=()=>{j(""),N(0),b(0),_(""),w("medium"),k("")},F=e=>{const{weight:a,age:s,activity_level:t}=e.health_data;let l=20*a;switch(s<1?l*=1.2:s>7&&(l*=.8),t){case"low":l*=.8;break;case"high":l*=1.2}return`${5*Math.round(l/5)}g per day`},P=e=>{const{age:a}=e.health_data;return a<1?"3-4 times per day":a<7?"2 times per day":"2-3 smaller meals per day"};return s?(0,i.jsxs)("div",{className:"loading-container",children:[(0,i.jsx)("div",{className:"loading-spinner"}),(0,i.jsx)("p",{children:"Loading pet profiles..."})]}):(0,i.jsxs)("div",{className:"pets-container",children:[(0,i.jsxs)("div",{className:"pets-header",children:[(0,i.jsx)("h1",{children:"My Pets"}),(0,i.jsxs)("button",{className:"btn btn-primary",onClick:()=>{E(),m(null),o(!0)},children:[(0,i.jsx)("i",{className:"icon-plus"})," Add Pet"]})]}),r&&(0,i.jsxs)("div",{className:"error-alert",children:[(0,i.jsx)("i",{className:"icon-warning"}),(0,i.jsx)("p",{children:r}),(0,i.jsx)("button",{className:"error-close",onClick:()=>d(null),children:"\xd7"})]}),0===e.length?(0,i.jsxs)("div",{className:"no-pets",children:[(0,i.jsx)("div",{className:"no-pets-icon",children:(0,i.jsx)("i",{className:"icon-paw"})}),(0,i.jsx)("h2",{children:"No pets added yet"}),(0,i.jsx)("p",{children:"Add your pets to track their feeding schedules and health data."}),(0,i.jsx)("button",{className:"btn btn-primary",onClick:()=>{E(),o(!0)},children:"Add Your First Pet"})]}):(0,i.jsx)("div",{className:"pets-grid",children:e.map((e=>(0,i.jsxs)("div",{className:"pet-card",children:[(0,i.jsxs)("div",{className:"pet-card-header",children:[(0,i.jsx)("h3",{children:e.name}),(0,i.jsxs)("div",{className:"pet-actions",children:[(0,i.jsx)("button",{className:"btn btn-icon",onClick:()=>(e=>{m(e),j(e.name),N(e.health_data.weight),b(e.health_data.age),_(e.health_data.breed||""),w(e.health_data.activity_level||"medium"),k((e.health_data.dietary_restrictions||[]).join(", ")),o(!0)})(e),title:"Edit Pet",children:(0,i.jsx)("i",{className:"icon-edit"})}),(0,i.jsx)("button",{className:"btn btn-icon btn-danger",onClick:()=>u(e.pet_id),title:"Delete Pet",children:(0,i.jsx)("i",{className:"icon-trash"})})]})]}),(0,i.jsxs)("div",{className:"pet-info",children:[(0,i.jsxs)("div",{className:"pet-detail",children:[(0,i.jsx)("span",{className:"detail-label",children:"Weight:"}),(0,i.jsxs)("span",{className:"detail-value",children:[e.health_data.weight," kg"]})]}),(0,i.jsxs)("div",{className:"pet-detail",children:[(0,i.jsx)("span",{className:"detail-label",children:"Age:"}),(0,i.jsxs)("span",{className:"detail-value",children:[e.health_data.age," ",1===e.health_data.age?"year":"years"]})]}),e.health_data.breed&&(0,i.jsxs)("div",{className:"pet-detail",children:[(0,i.jsx)("span",{className:"detail-label",children:"Breed:"}),(0,i.jsx)("span",{className:"detail-value",children:e.health_data.breed})]}),(0,i.jsxs)("div",{className:"pet-detail",children:[(0,i.jsx)("span",{className:"detail-label",children:"Activity Level:"}),(0,i.jsx)("span",{className:"detail-value pet-activity",children:e.health_data.activity_level||"Medium"})]}),e.health_data.dietary_restrictions&&e.health_data.dietary_restrictions.length>0&&(0,i.jsxs)("div",{className:"pet-detail",children:[(0,i.jsx)("span",{className:"detail-label",children:"Dietary Restrictions:"}),(0,i.jsx)("div",{className:"dietary-tags",children:e.health_data.dietary_restrictions.map(((e,a)=>(0,i.jsx)("span",{className:"dietary-tag",children:e},a)))})]})]}),(0,i.jsxs)("div",{className:"pet-recommendations",children:[(0,i.jsx)("h4",{children:"Feeding Recommendations"}),(0,i.jsxs)("div",{className:"recommendation-item",children:[(0,i.jsx)("i",{className:"icon-bowl"}),(0,i.jsxs)("div",{className:"recommendation-content",children:[(0,i.jsx)("span",{className:"recommendation-label",children:"Daily Amount"}),(0,i.jsx)("span",{className:"recommendation-value",children:F(e)})]})]}),(0,i.jsxs)("div",{className:"recommendation-item",children:[(0,i.jsx)("i",{className:"icon-clock"}),(0,i.jsxs)("div",{className:"recommendation-content",children:[(0,i.jsx)("span",{className:"recommendation-label",children:"Schedule"}),(0,i.jsx)("span",{className:"recommendation-value",children:P(e)})]})]})]})]},e.pet_id)))}),c&&(0,i.jsx)("div",{className:"modal-overlay",children:(0,i.jsxs)("div",{className:"modal-content",children:[(0,i.jsxs)("div",{className:"modal-header",children:[(0,i.jsx)("h2",{children:h?`Edit ${h.name}`:"Add New Pet"}),(0,i.jsx)("button",{className:"modal-close",onClick:()=>o(!1),children:"\xd7"})]}),(0,i.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{const{data:{user:e}}=await l.N.auth.getUser();if(!e)throw new Error("User not authenticated");if(!x.trim())return void d("Pet name is required");const a=C.split(",").map((e=>e.trim())).filter((e=>e.length>0)),s={weight:v,age:g,breed:y.trim(),activity_level:f,dietary_restrictions:a};if(h){const{error:e}=await l.N.from("pets").update({name:x.trim(),health_data:s}).eq("pet_id",h.pet_id);if(e)throw e}else{const{error:a}=await l.N.from("pets").insert([{user_id:e.id,name:x.trim(),health_data:s}]);if(a)throw a}o(!1),E(),m(null)}catch(a){console.error("Error saving pet:",a),d(a.message||"Failed to save pet")}},children:[(0,i.jsxs)("div",{className:"modal-body",children:[(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{htmlFor:"pet-name",children:"Name"}),(0,i.jsx)("input",{id:"pet-name",type:"text",value:x,onChange:e=>j(e.target.value),placeholder:"Pet name",required:!0})]}),(0,i.jsxs)("div",{className:"form-row",children:[(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{htmlFor:"pet-weight",children:"Weight (kg)"}),(0,i.jsx)("input",{id:"pet-weight",type:"number",min:"0.1",step:"0.1",value:v,onChange:e=>N(parseFloat(e.target.value)||0),placeholder:"Weight"})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{htmlFor:"pet-age",children:"Age (years)"}),(0,i.jsx)("input",{id:"pet-age",type:"number",min:"0.1",step:"0.1",value:g,onChange:e=>b(parseFloat(e.target.value)||0),placeholder:"Age"})]})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{htmlFor:"pet-breed",children:"Breed (optional)"}),(0,i.jsx)("input",{id:"pet-breed",type:"text",value:y,onChange:e=>_(e.target.value),placeholder:"Breed"})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{htmlFor:"pet-activity",children:"Activity Level"}),(0,i.jsxs)("select",{id:"pet-activity",value:f,onChange:e=>w(e.target.value),children:[(0,i.jsx)("option",{value:"low",children:"Low"}),(0,i.jsx)("option",{value:"medium",children:"Medium"}),(0,i.jsx)("option",{value:"high",children:"High"})]})]}),(0,i.jsxs)("div",{className:"form-group",children:[(0,i.jsx)("label",{htmlFor:"pet-dietary",children:"Dietary Restrictions (comma-separated, optional)"}),(0,i.jsx)("input",{id:"pet-dietary",type:"text",value:C,onChange:e=>k(e.target.value),placeholder:"e.g., grain-free, low-fat"}),(0,i.jsx)("small",{className:"form-note",children:"Separate multiple restrictions with commas"})]})]}),(0,i.jsxs)("div",{className:"modal-footer",children:[(0,i.jsx)("button",{type:"button",className:"btn btn-outline",onClick:()=>o(!1),children:"Cancel"}),(0,i.jsx)("button",{type:"submit",className:"btn btn-primary",children:h?"Save Changes":"Add Pet"})]})]})]})}),p&&(0,i.jsx)("div",{className:"modal-overlay",children:(0,i.jsxs)("div",{className:"modal-content",children:[(0,i.jsxs)("div",{className:"modal-header",children:[(0,i.jsx)("h2",{children:"Delete Pet"}),(0,i.jsx)("button",{className:"modal-close",onClick:()=>u(null),children:"\xd7"})]}),(0,i.jsx)("div",{className:"modal-body",children:(0,i.jsx)("p",{className:"confirm-message",children:"Are you sure you want to delete this pet? This action cannot be undone."})}),(0,i.jsxs)("div",{className:"modal-footer",children:[(0,i.jsx)("button",{className:"btn btn-outline",onClick:()=>u(null),children:"Cancel"}),(0,i.jsx)("button",{className:"btn btn-danger",onClick:()=>(async e=>{try{const{error:a}=await l.N.from("pets").delete().eq("pet_id",e);if(a)throw a;u(null)}catch(a){console.error("Error deleting pet:",a),d(`Failed to delete pet: ${a.message}`)}})(p),children:"Delete Pet"})]})]})})]})}}}]);
//# sourceMappingURL=503.78286c21.chunk.js.map